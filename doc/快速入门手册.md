# 快速入门手册

## 准备工作
  配置AI AGENT 所需环境变量：
  - 在项目根目录创建 `.env` 文件，添加以下内容：
    ```env
    DEEPSEEK_API_KEY=sk-YOUR_DEEPSEEK_API_KEY_HERE
    DEEPSEEK_API_URL=https://api.deepseek.com/chat/completions
    ```
## 快速指南
- 后端服务启动：`docker-compose up --build -d`，访问 `http://localhost:3000`。
- 管理员账号登录后台：`admin` / `admin123`。
- 小程序端预览：使用微信开发者工具打开 `app/` 目录。
- 数据库初始化：首次启动时会自动执行 `./sql/init.sql` 创建表与初始数据。
- RabbitMQ 本地启动：在 `docker-compose.yml` 中已配置 RabbitMQ 服务，访问管理 UI `http://localhost:15672`，默认账号 `guest` / `guest`。
- 订单消息队列：参考 `doc/mq-guidelines.md` 了解发布/订阅规范与错误处理建议。
- 调试建议与开发流程：参考 `doc/前后端集成注意事项.md` 了解常见问题与改进要点。


## 常见问题
- 数据库未初始化：检查 MySQL 容器日志，确认 `init.sql` 已执行。
- 挂号失败或超额预约：确保后端代码已正确实现事务与行锁。
- RabbitMQ 连接失败：确认 `MQ_URL` 环境变量正确指向 RabbitMQ 服务地址。
- 消息未被处理：检查消费者是否已正确订阅队列，查看 RabbitMQ 管理 UI 监控队列状态。
- 支付状态未更新：确认支付回调逻辑已正确实现，并检查订单与支付表关联字段。
- 前端请求失败：参考 `doc/接口规范说明.md` 检查请求格式与错误码处理。

## 快速脚本
- 数据库异常重置脚本：
  ```bash
  docker-compose down
  docker volume rm HospitalManage_mysql-data
  docker-compose up --build -d
  ```
- 查看 MySQL 容器日志：
    ```bash
    docker logs -f hospital-mysql
    ```
- 建表与初始数据导入（手动执行）：
    ```bash
    docker exec -i hospital-mysql mysql -uroot -p123456 hospital < ./sql/init.sql
    ```
    
## 手动部署指南
当Docker失效或需要在生产环境中部署时，可参考以下步骤：
1. 安装MySQL，创建数据库`hospital`，并执行`./sql/init.sql`导入初始数据。
~~~bash
sudo apt-get install mysql-server
mysql -u root -p
CREATE DATABASE hospital;
SOURCE /path/to/init.sql;
~~~
2. 安装Node.js环境，推荐使用Node.js 16及以上版本。
~~~bash
curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash -
sudo apt-get install -y nodejs
~~~
3. 克隆项目代码并安装依赖。
~~~bash
git clone https://github.com/ALKYH/HospitalManage
cd HospitalManage
npm install
~~~
4. 配置环境变量，创建`.env`文件，参考`.env.example`进行配置。
5. 启动后端服务。
~~~bash
npm run start
~~~
