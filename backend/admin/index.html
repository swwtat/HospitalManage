<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Hospital Admin</title>
  <style>
    /* 仅保留少量自定义样式，主要样式交由 Pico.css */
    .panel{padding:12px;margin-bottom:12px;border-radius:8px;border:1px solid var(--pico-muted-border-color)}
    .tabBtn{opacity:1}
    .tabBtn.active{opacity:.9}
    .table-wrap{overflow:auto}
    .toolbar{display:flex;gap:12px;align-items:center}
    .toolbar .spacer{margin-left:auto}
    /* 抽屉侧栏样式 */
    .drawer-container{display:flex; gap:16px}
    .drawer{position:fixed; top:16px; left:16px; max-height:calc(100vh); width:clamp(240px, 30vw, 360px); background:var(--pico-background-color);
      border:1px solid var(--pico-muted-border-color); border-radius:12px; box-shadow: 0 10px 34px rgba(0,0,0,.12);
      transform: translateX(-120%); transition: transform .25s ease; z-index: 20; padding:16px; overflow:auto}
    .drawer[data-visible="true"]{transform: translateX(0)}
    .drawer-backdrop{position:fixed; inset:0; background:rgba(0,0,0,.25); backdrop-filter:saturate(180%) blur(2px);
      opacity:0; pointer-events:none; transition: opacity .25s ease; z-index: 15}
    .drawer-backdrop[data-visible="true"]{opacity:1; pointer-events:auto}
    /* 大屏不强制常显，保持可抽屉收起/展开 */
    @media (min-width: 1024px){
      .drawer{top:24px; left:24px; height:calc(100vh - 48px); width:clamp(240px, 26vw, 420px)}
      .drawer-container{margin-top:16px}
    }
    /* 登录页样式 */
    .login-wrap{min-height:60vh; display:flex; align-items:center; justify-content:center}
    .login-card{width:100%; max-width:360px; padding:20px; border:1px solid var(--pico-muted-border-color); border-radius:12px}
    .login-title{margin:0 0 12px}
    .login-actions{margin-top:8px}
    /* 表格内动作按钮紧凑样式 */
    .compact-actions{display:flex; gap:8px}
    .compact-btn{padding:.35em .6em; font-size:.875em}
  </style>
  <!-- （自动支持明暗色） -->
  <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@2/css/pico.min.css">
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
</head>
<body>
  <div id="app">
    <header class="container">
      <nav>
        <ul>
          <li v-if="authed"><button aria-label="打开菜单" @click="sidebarOpen = !sidebarOpen">☰</button></li>
          <li><strong>管理后台</strong></li>
        </ul>
        <ul>
          <li><button class="secondary" @click="toggleTheme">切换主题</button></li>
        </ul>
      </nav>
    </header>

    <div class="drawer-container container">
      <!-- 抽屉侧栏 -->
      <aside class="drawer" :data-visible="sidebarOpen ? 'true' : 'false'">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px">
          <strong>导航</strong>
          <button class="secondary" aria-label="关闭" @click="sidebarOpen=false">✕</button>
        </div>
        <nav>
          <ul>
            <li><a href="#" :aria-current="curTab==='depts' ? 'page' : null" @click.prevent="switchTab('depts')">科室</a></li>
            <li><a href="#" :aria-current="curTab==='doctors' ? 'page' : null" @click.prevent="switchTab('doctors')">医生</a></li>
            <li><a href="#" :aria-current="curTab==='schedules' ? 'page' : null" @click.prevent="switchTab('schedules')">排班/号源</a></li>
            <li><a href="#" :aria-current="curTab==='orders' ? 'page' : null" @click.prevent="switchTab('orders')">订单</a></li>
          </ul>
          <ul>
            <li><button class="secondary" @click="logout">退出登录</button></li>
          </ul>
        </nav>
      </aside>
      <!-- 背景遮罩（小屏时可点击关闭抽屉） -->
      <div class="drawer-backdrop" :data-visible="sidebarOpen ? 'true' : 'false'" @click="sidebarOpen=false"></div>

      <main style="flex:1">
    <!-- 登录面板（竖直常见布局） -->
    <section v-if="!authed" class="login-wrap container">
      <article class="login-card">
        <h3 class="login-title">管理员登录</h3>
        <label>用户名
          <input v-model.trim="login.username" placeholder="请输入用户名" />
        </label>
        <label>密码
          <input v-model.trim="login.password" placeholder="请输入密码" type="password" />
        </label>
        <div class="login-actions">
          <button style="width:100%" @click="doLogin" :aria-busy="login.loading ? 'true' : 'false'" :disabled="login.loading">{{ login.loading? '登录中...' : '登录' }}</button>
        </div>
        <small style="color:#c00">{{ login.msg }}</small>
      </article>
    </section>

    <!-- 主界面 -->
    <div v-else>
      <!-- 顶部提示 -->
      <div class="panel">
        <div class="toolbar">
          <div style="color:var(--pico-muted-color)">提示：先创建科室，再添加医生；排班时先选科室再选医生。</div>
        </div>
      </div>

      <!-- 科室管理组件 -->
      <depts-panel v-show="curTab==='depts'"
        :depts="depts"
        :dept-form="deptForm"
        :depts-sub-tab="deptsSubTab"
        @update:depts-sub-tab="val=>deptsSubTab=val"
        @create-dept="createDept"
        @delete-dept="delDept"
        :find-dept-name="findDeptName"
      ></depts-panel>

      <!-- 医生管理组件 -->
      <doctors-panel v-show="curTab==='doctors'"
        :doctors="doctors"
        :depts="depts"
        :doctor-form="doctorForm"
        :doctors-sub-tab="doctorsSubTab"
        @update:doctors-sub-tab="val=>doctorsSubTab=val"
        :find-dept-name="findDeptName"
        @create-doctor="createDoctor"
        @delete-doctor="delDoctor"
        @set-doctor-pwd="setDoctorPwd"
      ></doctors-panel>

      <!-- 排班与号源组件 -->
      <schedules-panel v-show="curTab==='schedules'"
        :depts="depts"
        :doctors="doctors"
        :filtered-doctors="filteredDoctors"
        :sched="sched"
        :avail-list="availList"
        :sched-sub-tab="schedSubTab"
        @update:sched-sub-tab="val=>schedSubTab=val"
        :find-dept-name="findDeptName"
        :find-doctor-name="findDoctorName"
        :find-doctor-dept-id="findDoctorDeptId"
        :render-types="renderTypes"
        @change-dept="onSchedDeptChange"
        @save-availability="saveAvailability"
        @delete-availability="delAvailability"
      ></schedules-panel>

      <!-- 订单管理组件 -->
      <orders-panel v-show="curTab==='orders'"
        :orders="orders"
        :doctors="doctors"
        @refresh="fetchOrders"
        @cancel-order="cancelOrder"
      ></orders-panel>
      </main>
    </div>
  </div>

  <script type="module" src="./js/app.js"></script>
</body>
</html>
